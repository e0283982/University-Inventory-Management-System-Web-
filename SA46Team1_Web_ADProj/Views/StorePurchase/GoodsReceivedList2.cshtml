@{
    Layout = null;
}

<link href="@Url.Content("~/Content/common.css")" rel="stylesheet" type="text/css" />

<script>
    var table;
    $(document).ready(function () {

        $.ajax({
            url: 'http://localhost:49921/api/Restful/GetGoodsReceivedLists/' + $('#lbl-gr-grId').text() ,
            type: 'get',
            dataType: 'json',
            success: function (data) {
                table = $('#dataTable-displayGR').DataTable({
                    paging: true,
                    sort: true,
                    searching: true,
                    //scrollY: 200,
                    data: data,
                    columns: [
                        { 'data': 'ItemCode' },
                        { 'data': 'Description' },
                        { 'data': 'UoM' },
                        { 'data': 'QuantityReceived' },
                        { 'data': 'UnitCost'},
                        { 'data': 'Total' },
                        { 'defaultContent': '7%' }
                    ]
                });
                var date = new Date(data[0]["ReceivedDate"]);
                var month = date.getMonth() + 1;
                var newDate = date.getDate() + "/" + month + "/" + date.getFullYear();

                var i;
                var total = 0;
                for (i = 0; i < data.length; i++) {
                    total = total + data[i]["Total"];
                }
                var gst = total * 0.07;
                var netTotal = total + gst;

                $(function () {
                    $('#lbl-poNumber').val(data[0]["PONumber"]);
                    $('#lbl-del-date').val(newDate);
                    $('#lbl-companyName').val(data[0]["CompanyName"]);
                    $('#lbl-emp').val(data[0]["EmployeeName"]);
                    $('#lbl-gross-total').val(twoDP(total));
                    $('#lbl-gst').val(twoDP(gst));
                    $('#lbl-net-total').val(twoDP(netTotal));
                    $('#ta-remarks').val(data[0]["Remarks"]);
                });

                function twoDP(value) {
                    return parseFloat(Math.round(value * 100) / 100).toFixed(2);
                }

            }
        });
    });

    $(function () {
        $("#datepicker-GR-Date").datepicker();
    });

    $(function () {
        $("#dialog-print-displayGR").dialog({
            autoOpen: false
        });
    });

    $('#btn-print-displayGR').click(function () {
        $('#dialog-print-displayGR').dialog('open');
        return false;
    });
   
</script>

<div>
    <h2>Goods Receipt</h2>
</div>

<div>


    <button class="btn-blue" id="btn-print-displayGR">Goods Receipt</button>
    <div id="dialog-print-displayGR" class="hidden" title="Basic dialog">
        <p>Print via here.</p>
    </div>
</div>

<div>
    <label>Goods Receipt Number: <label id="lbl-gr-grId">@Session["grId"]</label></label>
    <br />
    <label>PO Number: <input type="text" id="lbl-poNumber"></label>
    <br />
    <label>Date: <input type="text" id="lbl-del-date"></label>
    <br />
    <label>Supplier: <input type="text" id="lbl-companyName"></label>
    <br />
    <label>Created By: <input type="text" id="lbl-emp"></label>
</div>

<div>
    <p>Remarks:</p>
    <textarea id="ta-remarks"></textarea>
</div>

<table id="dataTable-displayGR" class="display" style="width:80%;">
    <thead>
        <tr>
            <th>Item Code</th>
            <th>Product Name</th>
            <th>Unit of Measure</th>
            <th>Qty</th>
            <th>Price ($)</th>
            <th>Total ($)</th>
            <th>GST ($)</th>
        </tr>
    </thead>
</table>

<div>
    <label>Gross Total ($): <input type="text" id="lbl-gross-total"></label>
    <label>GST ($): <input type="text" id="lbl-gst"></label>
    <label>Net Total ($): <input type="text" id="lbl-net-total"></label>
</div>


<div id="details-back-btn">

    @using (Html.BeginForm("BackToGRList", "StorePurchase", FormMethod.Post))
    {
        <input class="btn-blue" type="submit" value="Back" />
    }
</div>
